<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Picture Battle | Vote on Images</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: white;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        /* Navigation */
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 10px;
        }
        
        .tab-btn {
            padding: 12px 25px;
            background: #e0e0e0;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        /* Voting Section */
        .voting-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        .battle-title {
            text-align: center;
            margin-bottom: 20px;
            color: #444;
        }
        
        .images-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }
        
        .image-card {
            flex: 1;
            min-width: 300px;
            max-width: 450px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        
        .image-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        .image-placeholder {
            width: 100%;
            height: 300px;
            background-color: #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
            font-size: 1.2rem;
        }
        
        .image-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .image-info {
            padding: 15px;
            background: white;
        }
        
        .vote-btn {
            display: block;
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .vote-btn:hover {
            background: linear-gradient(135deg, #5d7df0, #9666d8);
        }
        
        /* Upload Section */
        .upload-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        .upload-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-group label {
            font-weight: 600;
            color: #555;
        }
        
        .form-group input,
        .form-group textarea {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .upload-btn {
            padding: 12px;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .upload-btn:hover {
            background: linear-gradient(135deg, #5d7df0, #9666d8);
        }
        
        /* Results Section */
        .results-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-card {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .result-image {
            width: 100%;
            height: 200px;
            background-color: #eee;
        }
        
        .result-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .result-info {
            padding: 15px;
            background: white;
        }
        
        .votes-count {
            font-weight: bold;
            color: #6e8efb;
        }
        
        /* Footer */
        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #777;
        }
        
        /* Instructions */
        .instructions {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }
        
        .instructions h2 {
            margin-bottom: 15px;
            color: #444;
        }
        
        .instructions ol {
            margin-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 10px;
        }
        
        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left: 4px solid #6e8efb;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .images-container {
                flex-direction: column;
                align-items: center;
            }
            
            .image-card {
                width: 100%;
            }
            
            .tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Picture Battle</h1>
            <p>Upload images and vote on your favorites!</p>
        </header>
        
        <div class="instructions">
            <h2>How to Use This Website</h2>
            <ol>
                <li>View the current image battle in the "Vote" section</li>
                <li>Click "Vote for this" to choose your preferred image</li>
                <li>Upload your own images using the "Upload" section</li>
                <li>See the top-voted images in the "Results" section</li>
            </ol>
            <p><strong>Note:</strong> This demo uses Firebase for backend functionality.</p>
        </div>
        
        <div class="tabs">
            <button class="tab-btn active" data-tab="vote">Vote</button>
            <button class="tab-btn" data-tab="upload">Upload</button>
            <button class="tab-btn" data-tab="results">Results</button>
        </div>
        
        <main class="main-content">
            <section class="tab-content active" id="vote-tab">
                <div class="voting-section">
                    <h2 class="battle-title">Current Battle</h2>
                    <div id="battle-loading" class="spinner"></div>
                    <div class="images-container" id="battle-container" style="display: none;">
                        <!-- Images will be loaded here dynamically -->
                    </div>
                </div>
            </section>
            
            <section class="tab-content" id="upload-tab">
                <div class="upload-section">
                    <h2>Upload Your Image</h2>
                    <form class="upload-form" id="uploadForm">
                        <div class="form-group">
                            <label for="imageTitle">Image Title</label>
                            <input type="text" id="imageTitle" placeholder="Enter a title for your image" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="userName">Your Name</label>
                            <input type="text" id="userName" placeholder="Enter your name" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="imageUpload">Select Image</label>
                            <input type="file" id="imageUpload" accept="image/*" required>
                        </div>
                        
                        <button type="submit" class="upload-btn">Upload Image</button>
                    </form>
                    <div id="upload-status"></div>
                </div>
            </section>
            
            <section class="tab-content" id="results-tab">
                <div class="results-section">
                    <h2>Top Voted Images</h2>
                    <div id="results-loading" class="spinner"></div>
                    <div class="results-grid" id="results-container" style="display: none;">
                        <!-- Results will be loaded here dynamically -->
                    </div>
                </div>
            </section>
        </main>
        
        <footer>
            <p>&copy; 2023 Picture Battle. All rights reserved.</p>
            <p>Powered by Firebase for backend functionality.</p>
        </footer>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <script>
        // Firebase configuration - Replace with your own config
        const firebaseConfig = {
            apiKey: "AIzaSyEXAMPLE-REPLACE-THIS-WITH-YOUR-OWN-KEY",
            authDomain: "your-project-id.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project-id.appspot.com",
            messagingSenderId: "123456789",
            appId: "your-app-id"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
        
        // DOM elements
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        const uploadForm = document.getElementById('uploadForm');
        const uploadStatus = document.getElementById('upload-status');
        const battleContainer = document.getElementById('battle-container');
        const battleLoading = document.getElementById('battle-loading');
        const resultsContainer = document.getElementById('results-container');
        const resultsLoading = document.getElementById('results-loading');
        
        // Tab functionality
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.getAttribute('data-tab');
                
                // Remove active class from all buttons and contents
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                // Add active class to current button and content
                button.classList.add('active');
                document.getElementById(`${tabId}-tab`).classList.add('active');
                
                // Load data for the active tab
                if (tabId === 'vote') {
                    loadBattleImages();
                } else if (tabId === 'results') {
                    loadTopImages();
                }
            });
        });
        
        // Load two random images for voting
        async function loadBattleImages() {
            battleLoading.style.display = 'block';
            battleContainer.style.display = 'none';
            battleContainer.innerHTML = '';
            
            try {
                const snapshot = await db.collection('images').get();
                const images = [];
                
                snapshot.forEach(doc => {
                    images.push({ id: doc.id, ...doc.data() });
                });
                
                if (images.length < 2) {
                    battleLoading.style.display = 'none';
                    battleContainer.innerHTML = '<p>Not enough images for a battle yet. Upload some images first!</p>';
                    battleContainer.style.display = 'block';
                    return;
                }
                
                // Select two random images
                const randomImages = [];
                while (randomImages.length < 2 && images.length > 0) {
                    const randomIndex = Math.floor(Math.random() * images.length);
                    randomImages.push(images[randomIndex]);
                    images.splice(randomIndex, 1);
                }
                
                // Display the images
                randomImages.forEach((image, index) => {
                    const imageCard = document.createElement('div');
                    imageCard.className = 'image-card';
                    imageCard.id = `image${index + 1}`;
                    
                    imageCard.innerHTML = `
                        <div class="image-placeholder">
                            <img src="${image.downloadURL}" alt="${image.title}">
                        </div>
                        <div class="image-info">
                            <h3>${image.title}</h3>
                            <p>Uploaded by: ${image.author}</p>
                            <button class="vote-btn" data-image="${image.id}">Vote for this</button>
                        </div>
                    `;
                    
                    battleContainer.appendChild(imageCard);
                });
                
                // Add event listeners to vote buttons
                const voteButtons = battleContainer.querySelectorAll('.vote-btn');
                voteButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const imageId = this.getAttribute('data-image');
                        voteForImage(imageId, this);
                    });
                });
                
                battleLoading.style.display = 'none';
                battleContainer.style.display = 'flex';
            } catch (error) {
                console.error("Error loading battle images:", error);
                battleLoading.style.display = 'none';
                battleContainer.innerHTML = '<p>Error loading images. Please try again later.</p>';
                battleContainer.style.display = 'block';
            }
        }
        
        // Vote for an image
        async function voteForImage(imageId, button) {
            try {
                // Update vote count in Firestore
                const imageRef = db.collection('images').doc(imageId);
                await imageRef.update({
                    votes: firebase.firestore.FieldValue.increment(1)
                });
                
                // Visual feedback
                button.textContent = 'Voted!';
                button.style.background = '#4CAF50';
                button.disabled = true;
                
                // Disable the other vote button
                const otherButton = document.querySelector('.vote-btn:not([disabled])');
                if (otherButton) {
                    otherButton.style.opacity = '0.7';
                    otherButton.disabled = true;
                }
            } catch (error) {
                console.error("Error voting:", error);
                alert("Error recording vote. Please try again.");
            }
        }
        
        // Load top voted images
        async function loadTopImages() {
            resultsLoading.style.display = 'block';
            resultsContainer.style.display = 'none';
            resultsContainer.innerHTML = '';
            
            try {
                const snapshot = await db.collection('images')
                    .orderBy('votes', 'desc')
                    .limit(4)
                    .get();
                
                if (snapshot.empty) {
                    resultsLoading.style.display = 'none';
                    resultsContainer.innerHTML = '<p>No images yet. Upload some images first!</p>';
                    resultsContainer.style.display = 'grid';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const image = { id: doc.id, ...doc.data() };
                    
                    const resultCard = document.createElement('div');
                    resultCard.className = 'result-card';
                    
                    resultCard.innerHTML = `
                        <div class="result-image">
                            <img src="${image.downloadURL}" alt="${image.title}">
                        </div>
                        <div class="result-info">
                            <h3>${image.title}</h3>
                            <p>By: ${image.author}</p>
                            <p class="votes-count">Votes: ${image.votes || 0}</p>
                        </div>
                    `;
                    
                    resultsContainer.appendChild(resultCard);
                });
                
                resultsLoading.style.display = 'none';
                resultsContainer.style.display = 'grid';
            } catch (error) {
                console.error("Error loading top images:", error);
                resultsLoading.style.display = 'none';
                resultsContainer.innerHTML = '<p>Error loading results. Please try again later.</p>';
                resultsContainer.style.display = 'grid';
            }
        }
        
        // Handle image upload
        uploadForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const title = document.getElementById('imageTitle').value;
            const user = document.getElementById('userName').value;
            const file = document.getElementById('imageUpload').files[0];
            
            if (!file) {
                uploadStatus.innerHTML = '<p style="color: red;">Please select an image file</p>';
                return;
            }
            
            // Check if file is an image
            if (!file.type.match('image.*')) {
                uploadStatus.innerHTML = '<p style="color: red;">Please select an image file (JPEG, PNG, etc.)</p>';
                return;
            }
            
            try {
                uploadStatus.innerHTML = '<p>Uploading image...</p>';
                
                // Create storage reference
                const storageRef = storage.ref();
                const fileRef = storageRef.child(`images/${file.name + Date.now()}`);
                
                // Upload file
                const snapshot = await fileRef.put(file);
                
                // Get download URL
                const downloadURL = await snapshot.ref.getDownloadURL();
                
                // Add to Firestore
                await db.collection('images').add({
                    title: title,
                    author: user,
                    votes: 0,
                    downloadURL: downloadURL,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                uploadStatus.innerHTML = `<p style="color: green;">Thank you, ${user}! Your image "${title}" has been uploaded.</p>`;
                uploadForm.reset();
                
            } catch (error) {
                console.error("Error uploading:", error);
                uploadStatus.innerHTML = '<p style="color: red;">Error uploading image. Please try again.</p>';
            }
        });
        
        // Load battle images on page load
        loadBattleImages();
    </script>
</body>
</html>